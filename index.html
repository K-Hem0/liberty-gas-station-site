<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Liberty Gas Station</title>
  <meta name="description" content="Liberty Gas Station ‚Äî Breakfast & Lunch Menu in Elkton, VA" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet" />

  <!-- Favicon / OpenGraph -->
  <link rel="icon" href="assets/favicon.ico" />
  <meta property="og:title" content="Liberty Gas Station" />
  <meta property="og:description" content="Breakfast & Lunch Menu in Elkton, VA" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="assets/og-image.jpg" />
  <meta property="og:url" content="https://elktonliberty.com" />

  <!-- Site CSS -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <!-- Critical overrides for spacing & map z-index (kept inline so they always win) -->
  <style>
    html, body { margin:0; padding:0; }
    .site-header { padding:0 !important; position:sticky; top:0; background:#fff; border-bottom:4px solid #0e7c86; z-index:99999; isolation:isolate; }
    .header-inner{ display:flex; align-items:center; justify-content:space-between; gap:14px; }
    .logo { margin:0; line-height:0; }
    .logo img { display:block; max-height:120px; height:auto; width:auto; }

    /* Keep map below header; clip controls to card */
    .map-card, .map-frame, #map, .leaflet-container { position:relative; z-index:0; overflow:hidden; border-radius:10px; }
    .leaflet-top, .leaflet-bottom, .leaflet-control-container { z-index:100 !important; }
    .leaflet-pane.leaflet-popup-pane{ z-index:500 !important; }
    .leaflet-pane.leaflet-marker-pane{ z-index:450 !important; }
    .leaflet-pane.leaflet-overlay-pane{ z-index:400 !important; }

    @media (max-width:600px){
      .logo img{ max-height:90px; }
    }
  </style>
</head>

<body style="font-family: 'Poppins', sans-serif; color:#1f2a37; background:#fff;">
  <a class="skip-link" href="#menu">Skip to menu</a>

  <!-- Header -->
  <header class="site-header">
    <div class="container header-inner">
      <h1 class="logo">
        <img src="assets/logo.png" alt="Liberty Gas and Deli">
      </h1>

      <!-- DoorDash CTA (header) -->
      <a class="cta" href="https://www.doordash.com/store/YOUR-STORE-ID"
        target="_blank" rel="noopener" aria-label="Order on DoorDash">
        üçî Order on DoorDash
      </a>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero" style="position:relative;">
    <img src="https://images.unsplash.com/photo-1550547660-d9450f859349?q=80&w=1600&auto=format&fit=crop" alt="Classic diner burger and fries" />
    <div class="overlay">
      <h2 style="font-family:'Merriweather', serif; font-size:28px;">Breakfast & Lunch ¬∑ Elkton, VA</h2>
    </div>
  </section>

  <main class="container grid">
    <!-- LEFT: content -->
    <div>
      <!-- Map + address card -->
      <section class="info" id="info" style="margin:0 0 22px 0;">
        <div class="card map-card">
          <div class="map-grid">
            <!-- Details (left) -->
            <div class="map-details" style="padding:16px;">
              <h3>Find Us</h3>
              <p style="margin:.25rem 0 0">607 7th St<br/>Elkton, VA 22827</p>
              <div class="map-cta-row">
                <a class="btn btn-primary" href="https://maps.google.com/?q=607+7th+St+Elkton+VA+22827" target="_blank" rel="noopener">üìç Get Directions</a>
                <a class="btn btn-muted" href="#menu">üçΩ View Menu</a>
              </div>
            </div>
            <!-- Map (right) -->
            <div class="map-frame" aria-label="Map showing Liberty Gas Station location">
              <div id="map"></div>
              <noscript>
                <div style="padding:10px">
                  <a href="https://maps.google.com/?q=607+7th+St+Elkton+VA+22827" target="_blank" rel="noopener">View map</a>
                </div>
              </noscript>
            </div>
          </div>
        </div>
      </section>

      <!-- MENU (static content shown if menu.json not found; renderer will rebuild) -->
      <section id="menu">
        <h2 class="menu-title" style="color:#0e7c86; font-family:'Merriweather',serif;">Breakfast</h2>
        <div class="menu-block">
          <h4>Biscuits</h4>
          <table class="menu-table">
            <tbody>
              <tr><td class="item-name"><a href="#" data-info="Allergens: wheat/gluten, dairy (if cheese), pork.">Sausage Biscuit</a></td><td class="price">$1.99</td></tr>
              <tr><td class="item-name"><a href="#" data-info="Allergens: wheat/gluten; pork.">Bacon Biscuit</a></td><td class="price">$1.99</td></tr>
              <tr><td class="item-name"><a href="#" data-info="Allergens: wheat/gluten; poultry.">Chicken Biscuit</a></td><td class="price">$2.99</td></tr>
              <tr><td class="item-name"><a href="#" data-info="Allergens: wheat/gluten; pork.">Ham Biscuit</a></td><td class="price">$1.99</td></tr>
              <tr><td class="item-name"><a href="#" data-info="Allergens: wheat/gluten, dairy; pork.">Sausage &amp; Cheese Biscuit</a></td><td class="price">$2.49</td></tr>
              <tr><td class="item-name"><a href="#" data-info="Allergens: wheat/gluten, dairy; pork.">Ham &amp; Cheese Biscuit</a></td><td class="price">$2.49</td></tr>
              <tr><td class="item-name"><a href="#" data-info="Allergens: wheat/gluten, dairy; pork.">Sausage, Ham &amp; Cheese Biscuit</a></td><td class="price">$2.99</td></tr>
            </tbody>
          </table>
        </div>

        <h2 class="menu-title" style="color:#0e7c86; font-family:'Merriweather',serif; margin-top:28px;">Lunch &amp; Dinner</h2>
        <div class="menu-block">
          <h4>Pizzas (Two Sizes)</h4>
          <table class="menu-table">
            <tbody>
              <tr><td class="item-name"><a href="#" data-info="Allergens: wheat/gluten, dairy.">Cheese</a></td><td class="price">$13.99 / $17.99</td></tr>
              <tr><td class="item-name"><a href="#" data-info="Allergens: wheat/gluten, dairy; pork.">Pepperoni</a></td><td class="price">$13.99 / $17.99</td></tr>
            </tbody>
          </table>
        </div>

        <p class="note">Prices subject to change. Please inform us of any allergies or dietary restrictions; cross-contact may occur.</p>
      </section>
    </div>

    <!-- RIGHT: sidebar -->
    <aside class="sidebar" aria-label="Business hours and phone">
      <!-- Order card -->
      <div class="card order-card">
        <h3>Order Online</h3>
        <a class="dd-link" href="https://www.doordash.com/store/YOUR-STORE-ID" target="_blank" rel="noopener" aria-label="Order on DoorDash">üçî Order on DoorDash</a>
      </div>

      <!-- Hours card -->
      <div class="card hours-card">
        <div class="today" aria-live="polite">Open today:</div>
        <h3 style="margin-top:6px">Opening Hours</h3>
        <ul class="hours-list">
          <li><span class="hours-day">Monday</span><span class="hours-time">5 AM‚Äì10 PM</span></li>
          <li><span class="hours-day">Tuesday</span><span class="hours-time">5 AM‚Äì10 PM</span></li>
          <li><span class="hours-day">Wednesday</span><span class="hours-time">5 AM‚Äì10 PM</span></li>
          <li><span class="hours-day">Thursday</span><span class="hours-time">5 AM‚Äì10 PM</span></li>
          <li><span class="hours-day">Friday</span><span class="hours-time">5 AM‚Äì10 PM</span></li>
          <li><span class="hours-day">Saturday</span><span class="hours-time">6 AM‚Äì10 PM</span></li>
          <li><span class="hours-day">Sunday</span><span class="hours-time">6 AM‚Äì10 PM</span></li>
        </ul>
      </div>
    </aside>
  </main>

  <footer>
    <div class="container">
      <p>¬© <span id="year"></span> Liberty Gas Station ¬∑ <a href="https://www.doordash.com/store/YOUR-STORE-ID" style="color:#0e7c86">Order on DoorDash</a></p>
    </div>
  </footer>

  <!-- Allergy Modal -->
  <div id="allergyModal" class="modal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="allergyTitle">
      <button class="close" aria-label="Close">&times;</button>
      <h3 id="allergyTitle" style="margin-top:0; color:#0e7c86; font-family:'Merriweather',serif;">Allergy Info</h3>
      <p id="allergyText">Details coming soon‚Ä¶</p>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin="">
  </script>

  <!-- App JS -->
  <script>
    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Allergy modal
    const modal = document.getElementById('allergyModal');
    const modalText = document.getElementById('allergyText');
    const closeBtn = modal.querySelector('.close');

    function openModal(text){
      modalText.textContent = text || 'No information available.';
      modal.style.display = 'block';
      modal.setAttribute('aria-hidden','false');
    }
    function closeModal(){
      modal.style.display = 'none';
      modal.setAttribute('aria-hidden','true');
    }
    closeBtn.addEventListener('click', closeModal);
    window.addEventListener('click', e => { if(e.target === modal) closeModal(); });
    window.addEventListener('keydown', e => { if(e.key === 'Escape') closeModal(); });

    // Auto-highlight current day in hours list + badge
    function highlightToday(){
      const days = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
      const todayIndex = new Date().getDay();
      const hoursListItems = document.querySelectorAll('.hours-list li');
      let todayHours = '';
      let todayName  = days[todayIndex];

      hoursListItems.forEach(li => {
        const dayEl  = li.querySelector('.hours-day');
        const timeEl = li.querySelector('.hours-time');
        const dName = dayEl?.textContent.trim();
        if(dName === todayName){
          li.style.background = '#d9f0df';
          li.style.borderRadius = '6px';
          li.style.fontWeight = '600';
          todayHours = timeEl ? timeEl.textContent.trim() : '';
        }
      });

      const todayBadge = document.querySelector('.hours-card .today');
      if (todayBadge) todayBadge.textContent = todayHours ? `Open today: ${todayHours}` : `Open today: ${todayName}`;
    }
    highlightToday();

    // Interactive map (Leaflet + OSM)
    (function() {
      var fallbackLat = 38.4047, fallbackLng = -78.6239, fallbackZoom = 15;
      var mapEl = document.getElementById('map');
      if (!mapEl) return;

      var map = L.map('map', {scrollWheelZoom: true});
      map.setView([fallbackLat, fallbackLng], fallbackZoom);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);

      var popupHtml =
        '<strong>Liberty Gas Station</strong><br>' +
        '607 7th St, Elkton, VA 22827<br>' +
        '<a href="https://maps.google.com/?q=607+7th+St+Elkton+VA+22827" target="_blank" rel="noopener">Get Directions</a>';

      var marker = L.marker([fallbackLat, fallbackLng]).addTo(map).bindPopup(popupHtml);

      // Try geocoding address; fallback coords if rate-limited
      var q = encodeURIComponent('607 7th St, Elkton, VA 22827');
      fetch('https://nominatim.openstreetmap.org/search?format=json&limit=1&q=' + q, {
        headers: { 'Accept': 'application/json' }
      })
      .then(function(r){ return r.ok ? r.json() : []; })
      .then(function(data){
        if (Array.isArray(data) && data.length > 0) {
          var lat = parseFloat(data[0].lat), lon = parseFloat(data[0].lon);
          map.setView([lat, lon], fallbackZoom);
          marker.setLatLng([lat, lon]);
        }
      })
      .catch(function(){ /* keep fallback */ });

      /* ===== Map stability & mobile fixes ===== */
      function refreshLeaflet(){ try { map.invalidateSize(); } catch(e){} }

      // run after page settles
      window.addEventListener('load', () => setTimeout(refreshLeaflet, 300));
      // bounce on viewport changes (mobile URL bar show/hide, rotate)
      window.addEventListener('resize', () => setTimeout(refreshLeaflet, 150));
      window.addEventListener('orientationchange', () => setTimeout(refreshLeaflet, 150));
      // fonts can shift layout
      if (document.fonts && document.fonts.ready) {
        document.fonts.ready.then(() => setTimeout(refreshLeaflet, 150));
      }
      // when the map card first scrolls into view
      if ('IntersectionObserver' in window) {
        const io = new IntersectionObserver((entries) => {
          entries.forEach(e => { if (e.isIntersecting) setTimeout(refreshLeaflet, 150); });
        }, { threshold: 0.1 });
        io.observe(mapEl);
      }

      // Optional: prevent map from stealing scroll on touch until tapped
      const isTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
      if (isTouch) {
        map.scrollWheelZoom.disable();
        map.dragging.disable();
        mapEl.addEventListener('click', function once() {
          map.dragging.enable();
          refreshLeaflet();
          this.removeEventListener('click', once);
        }, { once: true });
      }
    })();

    /* === JSON renderer: reads menu.json and renders Hours + Menu === */
    (async function () {
      try {
        const res = await fetch('menu.json', { headers: { 'Accept': 'application/json' } });
        if (!res.ok) throw new Error('menu.json not found');
        const data = await res.json();

        // ---- Hours ----
        function renderHours(hours) {
          const ul = document.querySelector('.hours-list');
          if (!ul || !hours) return;
          const order = ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'];
          ul.innerHTML = '';
          order.forEach(d => {
            const li = document.createElement('li');
            li.innerHTML = `<span class="hours-day">${d}</span><span class="hours-time">${hours[d] || ''}</span>`;
            ul.appendChild(li);
          });
          if (typeof highlightToday === 'function') highlightToday();
        }

        // ---- Menu ----
        function makeRow(item) {
          const tr = document.createElement('tr');

          const nameTd = document.createElement('td');
          nameTd.className = 'item-name';
          const a = document.createElement('a');
          a.href = '#';
          a.textContent = item.name;
          if (item.allergens) a.setAttribute('data-info', item.allergens);
          nameTd.appendChild(a);

          const priceTd = document.createElement('td');
          priceTd.className = 'price';
          priceTd.textContent = (item.price ?? '‚Äî');

          tr.append(nameTd, priceTd);
          return tr;
        }

        function renderMenu(menuSections) {
          const sec = document.getElementById('menu');
          if (!sec || !Array.isArray(menuSections)) return;
          sec.innerHTML = '';

          menuSections.forEach(section => {
            const h2 = document.createElement('h2');
            h2.className = 'menu-title';
            h2.style.color = '#0e7c86';
            h2.style.fontFamily = "'Merriweather',serif";
            h2.textContent = section.section || '';
            sec.appendChild(h2);

            (section.groups || []).forEach(group => {
              const block = document.createElement('div');
              block.className = 'menu-block';

              const title = document.createElement('h4');
              title.textContent = group.title || '';
              block.appendChild(title);

              const wrap = document.createElement('div');
              wrap.className = 'table-wrap';

              const table = document.createElement('table');
              table.className = 'menu-table';

              const tbody = document.createElement('tbody');
              (group.items || []).forEach(item => tbody.appendChild(makeRow(item)));

              table.appendChild(tbody);
              wrap.appendChild(table);
              block.appendChild(wrap);

              if (group.note) {
                const p = document.createElement('p');
                p.className = 'note';
                p.textContent = group.note;
                block.appendChild(p);
              }

              sec.appendChild(block);
            });
          });

          // Bind allergy modal to the new links
          document.querySelectorAll('.menu-table .item-name a').forEach(link => {
            link.addEventListener('click', e => {
              e.preventDefault();
              openModal(link.getAttribute('data-info'));
            });
          });
        }

        // Render from JSON
        if (data.business && data.business.hours) renderHours(data.business.hours);
        if (data.menu) renderMenu(data.menu);

      } catch (err) {
        console.warn('Falling back to static HTML menu/hours:', err);
      }
    })();
  </script>
</body>
</html>
